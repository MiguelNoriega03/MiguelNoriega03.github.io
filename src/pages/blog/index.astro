---
import { getCollection } from 'astro:content';
import Pagination from '../../components/Pagination.astro';
import PostPreview from '../../components/PostPreview.astro';
import siteConfig from '../../data/site-config';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { sortItemsByDateDesc } from '../../utils/data-utils';

const posts = (await getCollection('blog')).sort(sortItemsByDateDesc);
const pageSize = siteConfig.postsPerPage || 4;
const totalPages = Math.ceil(posts.length / pageSize);
const currentPosts = posts.slice(0, pageSize);
---

<BaseLayout title="Blog" description="Embark on a journey of personal insights and experiences through my blog" showHeader={false}>
    <h1 class="mb-4 font-serif text-2xl leading-tight italic sm:mb-8 sm:text-4xl">Insights</h1>
    <p class="mb-12 text-base sm:text-lg text-theme-foreground/90">Publicamos aprendizajes accionables cuando cerramos etapas relevantes con clientes: sistemas comerciales, finanzas, automatizaci√≥n e IA.</p>
    {currentPosts.map((post) => <PostPreview post={post} class="mb-10 sm:mb-12" />)}
    {totalPages > 1 && (
        <Pagination 
            page={{
                currentPage: 1,
                lastPage: totalPages,
                url: {
                    current: '/blog',
                    prev: undefined,
                    next: totalPages > 1 ? '/blog/2' : undefined
                }
            }} 
            class="my-16 sm:my-24" 
        />
    )}
</BaseLayout>
